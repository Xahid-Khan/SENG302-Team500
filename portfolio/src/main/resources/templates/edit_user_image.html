<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://thymeleaf.org">
<head>
  <title>My Account</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link rel="stylesheet" th:href="@{styles/common.css}"/>
  <link rel="stylesheet" th:href="@{styles/pages/account_details.css}"/>
  <link rel="stylesheet" th:href="@{styles/pages/project_details.css}">
  <link rel="stylesheet" th:href="@{styles/navbar.css}"/>
  <link rel="stylesheet" th:href="@{styles/pages/edit_account.css}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.min.css" />

</head>
<body>
<div class="navbar">
  <div class="navbar-items">
    <div>
      <p class="title">SENG 302</p>
    </div>
    <div>
      <a href="project-details" id="home-page">Projects</a>
      <a href="user-list">View Users</a>
    </div>
  </div>


  <div class="account">
    <div class="dropdown">
      <button class="button dropbutton"><div class="username" th:text="${username}"></div>
        <div style="width: 46px;height: 46px;object-fit: cover;overflow: clip;">
          <img th:src="'//' + ${globalImagePath} + ${userId}"
               onerror="this.onerror=null;this.src='https://humanimals.co.nz/wp-content/uploads/2019/11/blank-profile-picture-973460_640.png'"
               alt="Placeholder Profile Photo" style="height: 50px;" width="46" height="46">
        </div>
      </button>
      <div class="dropdown-content">
        <a class="dropdown-content-links" href="my_account">My Account</a>
        <a class="dropdown-content-links" href="logout">Log Out</a>
      </div>
    </div>
  </div>
</div>

<span id="imageLink" th:text="'//' + ${globalImagePath} + ${userId}" hidden></span>
<div class="raised-card card-padding" style="display: grid; justify-content: center;">
  <form id='form' action="#" th:action="@{edit_account}" th:object="${user}" method="post" enctype="multipart/form-data">
    <h1 class="edit-title" style="float: left;">Edit User Photo</h1>
    <form id="deletePhotoForm" action="#" th:action="@{edit_account/imageDelete}" th:object="${user}" method="post"
          style="float:right; margin-left: 4px">
      <button class="button" style="float: right; margin-top: 25px;">
        Delete Photo
      </button>
    </form>
    <div>
      <div class="edit-crop-photo">
        <div id="croppie"></div>
      </div>

      <div class="edit-crop-photo">
        <img th:src="'//' + ${globalImagePath} + ${userId}" id="userProfileImage"
             onerror="this.onerror=null; this.hidden='true'; document.getElementById('submit').setAttribute('disabled', 'false') " width="300" height="300">
      </div>
    </div>
    <div>
      <div id="croppieTestId"></div>
    </div>
    <button id='submit' name="save" type="Submit" value="0" style="margin: 10px 3px 15px 3px" disabled>Save Photo</button>
    <button type="button" onclick="window.location.href='my_account'">Cancel</button>
  </form>

</div>

<script type="text/javascript" th:src="@{../frontend/cropping_image.js}"></script>

</body>
<script>
  let imageToUpload = "";
  const imageTest = await fetch(document.getElementById("imageLink").innerHTML);

</script>
<style>
  input, textarea {
    width: 100%;
    max-width: 100%;
  }

  .form-row {
    width: 100%;
    padding-bottom: 20px;
  }

  .edit-crop-photo {
    display: flex;
    justify-content: center;
    float: left;
    margin: 0 40px 0 40px;
  }

</style>
</html>
